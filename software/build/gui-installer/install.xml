<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>

<!--L
   Copyright SAIC, Ellumen and RSNA (CTP)


   Distributed under the OSI-approved BSD 3-Clause License.
   See http://ncip.github.com/national-biomedical-image-archive/LICENSE.txt for details.
L-->

<!--
    A sample installation file.
    Use it as a base for your own installers :-)

    To compile it :
    - go in the bin directory where you installed IzPack
    - call "compile ../sample/install.xml -b ../sample"
-->
<project name="nbia-gui-installer" default="build:installer" basedir=".">

  <property name="this.dir" location="${basedir}" />
  <property file="../project.properties" />
  <property name="software.location" location="${this.dir}/../.." />
  <property name="target.location" location="${software.location}/target" />
  <property name="dist.location" location="${target.location}/dist" />
  <property name="bda-utils.dir" location="${target.location}/bda-utils" />
  <property name="custom.resource.dir" location="${target.location}/izpack-custom/resources"/>

  <property name="project.name" value="nbia"/>
  <property name="installer.dir" value=".installer-${project.name}"/>
  <property name="gui-installer.dist.base.name" value="nbia_gui_distribution_${nbia.version}.jar"/>
  <property name="install.zip.file" value="${nbia.install.zip.file}"/>


  <echo message="compile.jar.dir ::: ${compile.jar.dir}"/>
  <echo message="this.dir ::: ${this.dir}"/>

  <taskdef name="IzPack" classpath="${compile.jar.dir}/lib/compiler.jar" classname="com.izforge.izpack.ant.IzPackTask"/>

  <target name="prepare:installer">
    <replaceregexp file="${this.dir}/build.xml" byline="true"
      match="^(.*property name=.*application_installer_zip.*value=&quot;)[^&quot;]+(&quot;.*)"
      replace="\1${install.zip.file}\2"/>
      <!--
    <replaceregexp file="${this.dir}/build.xml" byline="true"
      match="^(.*property name=.*application_upgrader_.*value=&quot;)[^&quot;]+(&quot;.*)"
      replace="\1${upgrade.zip.file}\2"/>
      -->
  </target>

  <target name="build:installer" depends="prepare:installer">
    <delete>
      <fileset dir="${dist.location}">
        <include name="${gui-installer.dist.base.name}*.jar"/>
      </fileset>
    </delete>
    <tstamp>
      <format property="build.time" pattern="yyyyMMddHHmm" />
    </tstamp>

    <IzPack output="${dist.location}/${gui-installer.dist.base.name}-${build.time}.jar"
      installerType="standard"
      basedir="."
      IzPackDir="${compile.jar.dir}/">
      <config><![CDATA[
      <installation version="1.0">

        <!--
        The info section.
        The meaning of the tags should be natural ...
        -->
        <info>
          <appname>nbia</appname>
          <appversion>@{nbia.version}</appversion>
          <authors>
              <author name="NCI" email=""/>
          </authors>
          <url>https://imaging.nci.nih.gov/</url>
          <javaversion>1.6</javaversion>
        </info>

        <!--
        The gui preferences indication.
        Sets the installer window to 640x480. It will not be able to change the size.
        -->
        <guiprefs width="1024" height="768" resizable="yes">
          <modifier key="useButtonIcons" value="no"/>
          <modifier key="useLabelIcons" value="no"/>
          <modifier key="allYGap" value="3"/>
          <modifier key="layoutAnchor" value="NORTHWEST"/>
          <modifier key="useHeadingPanel" value="yes"/>
          <modifier key="headingLineCount" value="1"/>
          <modifier key="headingFontSize" value="1.5"/>
          <modifier key="headingBackgroundColor" value="0x00ffffff"/>
          <modifier key="headingPanelCounter" value="text"/>
          <modifier key="headingPanelCounterPos" value="inHeading"/>
        </guiprefs>

        <!-- Need to define ant properties we want to use during install as variables -->
        <variables>

          <variable name="app.name" value="@{app.name}"/>
          <variable name="installer.dir" value="@{installer.dir}"/>
          <variable name="ncia-core-grid.jboss.relative.path" value="@{ncia-core-grid.jboss.relative.path}"/>
          <variable name="jboss.binaries.relative.dir" value="@{jboss.binaries.relative.dir}"/>
        </variables>

        <!--
        The locale section.
        Asks here to include the English and French langpacks.
        -->
        <locale>
          <langpack iso3="eng">
              <str id="AntAction.core" txt="Proceeding of ANT-activities"/>
              <str id="AntAction.install" txt="Revision of archives"/>
          </langpack>
        </locale>

        <conditions>
          <condition type="variable" id="install">
            <name>setup.type</name>
            <value>install</value>
          </condition>
          <condition type="variable" id="upgrade">
            <name>setup.type</name>
            <value>upgrade</value>
          </condition>
          <condition type="java" id="installonwindows">
            <java>
              <class>com.izforge.izpack.util.OsVersion</class>
              <field>IS_WINDOWS</field>
            </java>
            <returnvalue type="boolean">true</returnvalue>
          </condition>
          <condition type="java" id="installonlinux">
            <java>
              <class>com.izforge.izpack.util.OsVersion</class>
              <field>IS_LINUX</field>
            </java>
            <returnvalue type="boolean">true</returnvalue>
          </condition>
          <condition type="variable" id="ldap.setup">
            <name>authentication.type</name>
            <value>ldap</value>
          </condition>
          <!-- Container selection -->
          <condition type="variable" id="container.all">
            <name>install.selection</name>
            <value>install.all</value>
          </condition>
          <condition type="variable" id="container.jboss">
            <name>install.selection</name>
            <value>install.jboss</value>
          </condition>
          <condition type="variable" id="container.ncia-core-grid">
            <name>install.selection</name>
            <value>install.ncia-core-grid</value>
          </condition>
          <condition type="variable" id="container.database">
            <name>install.selection</name>
            <value>install.database</value>
          </condition>
          <condition type="variable" id="container.ctp">
            <name>install.selection</name>
            <value>install.ctp</value>
          </condition>
          <condition type="variable" id="cclogo">
            <name>cclogo.enabled</name>
            <value>true</value>
          </condition>
          <condition type="variable" id="ccwelcome">
            <name>ccwelcome.enabled</name>
            <value>true</value>
          </condition>
          <condition type="variable" id="ccquicklinks">
            <name>ccquicklinks.enabled</name>
            <value>true</value>
          </condition>
         <condition type="variable" id="ccfooter">
            <name>ccfooter.enabled</name>
            <value>true</value>
          </condition>

          <condition type="variable" id="grid.security">
            <name>ncia-core-grid.jboss.grid.secure.enable</name>
            <value>true</value>
          </condition>

          <condition type="or" id="jboss.or.all">
            <condition type="ref" refid="container.jboss"/>
            <condition type="ref" refid="container.all"/>
          </condition>

          <condition type="or" id="jboss.or.database.or.all">
            <condition type="ref" refid="container.database"/>
            <condition type="ref" refid="jboss.or.all"/>
          </condition>

          <!-- apparently cant reference the same condition more than once. -->


          <condition type="variable" id="selfsign">
            <name>selfsign.enabled</name>
            <value>true</value>
          </condition>

          <condition type="variable" id="mysql.database.type">
            <name>mysql.database.type</name>
            <value>true</value>
          </condition>

          <condition type="not" id="not.mysql.database.type">
            <condition type="ref" refid="mysql.database.type"/>
          </condition>


          <condition type="not" id="not.selfsign">
            <condition type="ref" refid="selfsign"/>
          </condition>


        </conditions>

        <!-- Identify your build targets for each of the contaiers for both install and upgrade -->
        <dynamicvariables>
          <variable name="database.type" value="mysql" condition="upgrade"/>

          <variable name="build.file.target" value="install" condition="install+container.all" />
          <variable name="build.file.target" value="install:jboss" condition="install+container.jboss" />
          <variable name="build.file.target" value="install:ncia-core-grid" condition="install+container.ncia-core-grid" />
          <variable name="build.file.target" value="install:database" condition="install+container.database" />
          <variable name="build.file.target" value="install:ctp" condition="install+container.ctp" />

          <variable name="build.file.target" value="upgrade" condition="upgrade+container.all" />
          <variable name="build.file.target" value="upgrade:jboss" condition="upgrade+container.jboss" />
          <variable name="build.file.target" value="upgrade:ncia-core-grid" condition="upgrade+container.ncia-core-grid" />
          <variable name="build.file.target" value="upgrade:database" condition="upgrade+container.database" />
          <variable name="build.file.target" value="upgrade:ctp" condition="upgrade+container.ctp" />

          <!-- conditionals for containers not chosen -->
          <variable name="jboss.relative.path" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>

          <variable name="jboss.server.name" value="" condition="container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.server.name" value="" condition="install+container.database"/>


          <variable name="jboss.web.user" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.web.password" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.server.ports.name" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.server.jndi.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <!-- Set to zero so math for jboss.ssl.port works -->

          <!-- core grid needs these to tie in to ncia-api -->
          <variable name="jboss.server.port" value="0" condition="container.database|container.ctp"/>
          <variable name="jboss.server.hostname" value="" condition="container.database|container.ctp"/>

          <variable name="jboss.cobraorb.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.ejbinvoker.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.hajndi.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.hajrmi.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.jms.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.jmx-rmi.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.messaging.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.pooledha.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.remoting.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.server.bind.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.server.rmi.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.service.rmiobject.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.snmp.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.snmp-trapd.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.web.service.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.ssl.enable" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.ssl.keystore.location" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.ssl.keystore.pass" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.ssl.keystore.alias" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.ssl.fullyqualified.hostname" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="exclude.jboss.backup" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.java.opts" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.external.http.host" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.external.http.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.external.ssl.host" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.external.ssl.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.external.grid.secure.host" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.external.grid.secure.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.grid.secure.enable" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.grid.secure.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.grid.secure.cert.location" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.grid.secure.key.location" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jboss.server.redirect.port" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="log4j.maxFileSize" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="log4j.maxDays" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="log4j.level" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>

          <variable name="grid.index.url" value="" condition="container.database|container.ctp"/>
          <variable name="grid.poc.tech.researchCenter.displayname" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.researchCenter.shortname" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.addr.country" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.addr.locality" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.addr.postalCode" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.addr.stateProvince" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.addr.street1" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.addr.street2" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.affiliation" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.name.last" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.name.first" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.phone" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.email" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.tech.role" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.science.affiliation" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.science.name.last" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.science.name.first" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.science.phone" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.science.email" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="grid.poc.science.role" value="" condition="container.database|container.jboss|container.ctp"/>

          <variable name="ldap.url" value="" condition="container.database|container.ctp"/>
          <variable name="ldap.basedn" value="" condition="container.database|container.ctp"/>
          <variable name="mail.smtp.server" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="authentication.type" value="" condition="container.database|container.ctp"/>

          <!-- ncia custom -->
          <variable name="ncia-core-grid.jboss.external.http.host" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.external.http.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.hostname" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.name" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.web.user" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.web.password" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.java.opts" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.jndi.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.rmi.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.ejbinvoker.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.cobraorb.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.hajndi.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.hajrmi.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.jms.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.jmx-rmi.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.messaging.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.pooledha.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.remoting.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.bind.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.server.redirect.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.service.rmiobject.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.snmp-trapd.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.snmp.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.web.service.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.tempZipLocation" value="" condition="container.database|container.jboss|container.ctp"/>

          <variable name="ncia-core-grid.jboss.thumbnailUrl" value="" condition="container.database|container.jboss|container.ctp"/>

          <variable name="grid.target" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.grid.secure.enable" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.grid.secure.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.grid.secure.cert.location" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.grid.secure.key.location" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.external.grid.secure.host" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.jboss.external.grid.secure.port" value="" condition="container.database|container.jboss|container.ctp"/>
          <variable name="ncia-core-grid.anonymous.permitted" value="" condition="container.database|container.jboss|container.ctp"/>


          <variable name="gov.nih.nci.ncia.zip.location" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.ftp.location" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.grid.local.node.name" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.ui.uid.display.length" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.ftp.url" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.jboss.mq.url" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.imaging.server.url" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.installationSite" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.admin.email" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.jboss.public.url" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="gov.nih.nci.ncia.download.server.url" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="enable_classic_download" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>

          <variable name="enabled_guest_account" value="" condition="container.ncia-core-grid|container.ctp"/>
          <variable name="guest_username" value="" condition="container.ncia-core-grid|container.ctp"/>
          <variable name="registration.email.subject" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>

          <variable name="local.grid.uri" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>



          <variable name="ctp.server.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.verifier.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.http_import_service.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.admin.password" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.king.password" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.storage_service.root" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.storage_service.index" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.server.require_authentication" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>

          <variable name="ctp.client.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.client.http_import_service.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.client.dicom_import_service.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.client.export_service.port" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.client.admin.password" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>
          <variable name="ctp.client.king.password" value="" condition="container.database|container.ncia-core-grid|container.jboss"/>


          <variable name="cancer.center.logo" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="cancer.center.background" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.left.submenu.quicklinks.path" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.welcome.image.path" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.welcome.text.path" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.welcome.title.path" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.applogo" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.applogo.visible" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="branding.footer.path" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>

          <variable name="jar-signing.keystore.location" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jar-signing.keystore.password" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jar-signing.keystore.alias" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jar-signing.execution.time" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
          <variable name="jar-signing.execution.time" value="install" condition="container.jboss|container.all"/>

          <variable name="jar-signing.generate-selfsigned" value="" condition="container.database|container.ncia-core-grid|container.ctp"/>
        </dynamicvariables>

        <!--
        The resources section.
        The ids must be these ones if you want to use the LicencePanel and/or the InfoPanel.
        -->
        <resources>
          <res id="Installer.image"  src="@{this.dir}/logotype.png"/>
          <res id="AntActionsSpec.xml" src="@{this.dir}/antActionSpec.xml" />
          <res id="HTMLLicencePanel.licence" src="@{custom.resource.dir}/Licence.html"/>
          <res id="InfoPanel.info" src="@{this.dir}/Readme.txt"/>
          <res id="userInputSpec.xml" src="@{this.dir}/userInputSpec.xml" />
          <res id="userInputLang.xml_eng" src="@{this.dir}/userInputLang.xml_eng" />

          <res id="CustomActionsLang.xml_eng" src="@{this.dir}/custom_eng.xml"/>
          <res id="UserPathPanel.dir.windows" src="@{this.dir}/windir.txt"/>
          <res id="UserPathPanel.dir.linux" src="@{this.dir}/linuxdir.txt" />
        </resources>

        <!--
        The panels section.
        We indicate here which panels we want to use. The order will be respected.
        <panel classname="PacksPanel" id="myuserinput" condition="pack2selected" />

        If you mess with the conditions, then may a higher power have mercy on your karma.
        once the conditions get beyond the very simple, your conception of logic will cease to be relevant
        (grouping, precedence, etc.)

        see: http://groups.google.com/group/izpack-scm/browse_thread/thread/23281fc6fdcd35a4
        -->
        <panels>
          <panel classname="HelloPanel"/>
          <panel classname="InfoPanel"/>
          <panel classname="HTMLLicencePanel"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.0" />
          <!-- Typical or Custom
          <panel classname="UserInputPanel"  id="UserInputPanel.1" condition="never"/>
          -->
          <panel classname="UserPathPanel" id="UserPathPanelInstallation" condition="install"/>
          <!-- Contaner selection -->
          <panel classname="UserInputPanel"  id="UserInputPanel.1"/>
          <!-- Upgrade, specify app homes and read properties -->
          <panel classname="UserInputPanel"  id="UserInputPanel.2" condition="upgrade"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.3" condition="upgrade+jboss.or.database.or.all"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.4" condition="upgrade+container.ncia-core-grid|container.all"/>

          <!-- Upgrade, read props -->
          <panel classname="UserInputPanel"  id="UserInputPanel.5" condition="upgrade+container.all"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.6" condition="upgrade+container.jboss"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.7" condition="upgrade+container.ncia-core-grid"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.8" condition="upgrade+container.database"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.9" condition="upgrade+container.ctp"/>
          <!-- Jboss Configuration -->
          <panel classname="UserInputPanel"  id="UserInputPanel.10" condition="container.jboss|container.all"/>
          <!-- Jboss Continued -->
          <panel classname="UserInputPanel"  id="UserInputPanel.11" condition="container.jboss|container.all"/>
          <!-- Authentication Type -->
          <panel classname="UserInputPanel"  id="UserInputPanel.12" condition="container.jboss|container.ncia-core-grid|container.all"/>
          <!-- Ldap data entry -->
          <panel classname="UserInputPanel"  id="UserInputPanel.13" condition="ldap.setup"/>
          <!-- Database Properties -->
          <panel classname="UserInputPanel"  id="UserInputPanel.14" condition="install"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.15" condition="mysql.database.type"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.16" condition="install+not.mysql.database.type"/>

          <!-- Global Configuraiton Options -->
          <panel classname="UserInputPanel"  id="UserInputPanel.17" condition="container.jboss|container.all"/>
          <!-- Grid Global Configuration -->
          <panel classname="UserInputPanel"  id="UserInputPanel.18" condition="container.ncia-core-grid|container.all"/>
          <!-- security -->
          <panel classname="UserInputPanel"  id="UserInputPanel.19" condition="grid.security"/>
          <!-- Grid Research Center -->
          <panel classname="UserInputPanel"  id="UserInputPanel.20" condition="container.ncia-core-grid|container.all"/>
          <!-- Grid Tech Contact -->
          <panel classname="UserInputPanel"  id="UserInputPanel.21" condition="container.ncia-core-grid|container.all"/>
          <!-- Grid Science Contact -->
          <panel classname="UserInputPanel"  id="UserInputPanel.22" condition="container.ncia-core-grid|container.all"/>


          <!-- jboss settings needed only when doing just the core grid -->
          <panel classname="UserInputPanel"  id="UserInputPanel.23" condition="container.ncia-core-grid"/>

          <!-- NCIA-CORE-GRID Properties -->
          <panel classname="UserInputPanel"  id="UserInputPanel.24" condition="container.ncia-core-grid|container.all"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.25" condition="container.ncia-core-grid|container.all"/>

          <!-- NCIA Configuration Properties-->
          <panel classname="UserInputPanel"  id="UserInputPanel.26" condition="container.jboss|container.all" />
          <!-- CTP Server Configuration Properties-->
          <panel classname="UserInputPanel"  id="UserInputPanel.27" condition="container.ctp|container.all"/>
          <!-- CTP Client Configuration Properties-->
          <panel classname="UserInputPanel"  id="UserInputPanel.28" condition="container.ctp|container.all" />
          <!-- branding -->
          <panel classname="UserInputPanel"  id="UserInputPanel.29" condition="container.jboss|container.all"  />
          <panel classname="UserInputPanel"  id="UserInputPanel.30" condition="cclogo+container.jboss|container.all" />
          <panel classname="UserInputPanel"  id="UserInputPanel.31" condition="ccwelcome+container.jboss|container.all" />
          <panel classname="UserInputPanel"  id="UserInputPanel.32" condition="ccquicklinks+container.jboss|container.all" />
          <panel classname="UserInputPanel"  id="UserInputPanel.33" condition="ccfooter+container.jboss|container.all" />

          <!-- Jar Signing -->
          <panel classname="UserInputPanel"  id="UserInputPanel.34" condition="container.jboss|container.all"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.35" condition="not.selfsign+container.jboss|container.all"/>
          <panel classname="UserInputPanel"  id="UserInputPanel.36" condition="selfsign+container.jboss|container.all"/>



          <!-- guest settings needed only when doing just the db -->
          <panel classname="UserInputPanel"  id="UserInputPanel.37" condition="container.database"/>

          <!-- index settings needed only when doing just the jboss - same as coregrid -->
          <panel classname="UserInputPanel"  id="UserInputPanel.38" condition="container.jboss"/>

          <panel classname="InstallationGroupPanel"/>
          <panel classname="ExtendedInstallPanel"/>
          <panel classname="FinishPanel"/>
        </panels>

        <listeners>
          <listener installer="SummaryLoggerInstallerListener">
            <os family="windows"/>
          </listener>

          <listener installer="ProgressBarInstallerListener"/>

          <listener installer="AntActionInstallerListener" uninstaller="AntActionUninstallerListener" />
        </listeners>




        <!--
        The packs section.
        We specify here our packs.
        -->
        <packs>
          <pack name="download_install" id="download_install" installGroups="nbia" required="no">
              <description>The base files</description>
              <file src="@{dist.location}/@{install.zip.file}" targetdir="$SYSTEM_user_home/@{installer.dir}"/>
              <file src="@{this.dir}/build.xml" targetdir="$SYSTEM_user_home/@{installer.dir}"/>
              <file src="@{this.dir}/property-template" override="true" targetdir="$SYSTEM_user_home/@{installer.dir}">
            <excludes>**/.svn/**</excludes>
              </file>
          </pack>

          <pack name="parse-install" required="no" preselected="no" condition="install">
              <description>parse the input values</description>
              <parsable targetfile="$SYSTEM_user_home/@{installer.dir}/nbia_installer/install.properties" type="javaprop" />
          </pack>

          <pack name="parse-upgrade" required="no" preselected="no" condition="upgrade">
              <description>parse the input values</description>
              <parsable targetfile="$SYSTEM_user_home/@{installer.dir}/nbia_installer/upgrade.properties" type="javaprop" />
          </pack>

          <pack name="convert-install-path" required="no" preselected="no" condition="install">
              <description>installation base path</description>
          </pack>

          <pack name="convert-upgrade-path" required="no" preselected="no" condition="upgrade">
              <description>Upgrade base path</description>
          </pack>

          <pack name="install-application" required="no" preselected="no" condition="install">
              <description>install the application</description>
          </pack>

        </packs>
        <jar src="@{bda-utils.dir}/ant-1.8.2.jar" stage="both" />
        <jar src="@{bda-utils.dir}/ant-launcher-1.8.2.jar" stage="both"/>
        <jar src="@{bda-utils.dir}/ant-nodeps-1.8.1.jar" stage="both"/>
        <jar src="@{bda-utils.dir}/mysql-connector-java-5.1.13.jar" stage="both"/>
        <jar src="@{bda-utils.dir}/ojdbc14-10.2.0.3.0.jar" stage="both"/>
      </installation>
    ]]></config>
    </IzPack>
    <property name="pre-install.dir" value="${target.location}/working/pre-install"/>
    <property name="build.dir" value="${software.location}/build"/>
    <mkdir dir="${pre-install.dir}"/>
    <copy tofile="${pre-install.dir}/install.xml" file="${build.dir}/install.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/ctp.xml" file="${build.dir}/ctp.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/ctp-macrodefs.xml" file="${build.dir}/ctp-macrodefs.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/jboss.xml" file="${build.dir}/jboss.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/database.xml" file="${build.dir}/database.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/ncia-core-grid.xml" file="${build.dir}/ncia-core-grid.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/ncia-core-grid-unsecured.xml" file="${build.dir}/ncia-core-grid-unsecured.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/nbia-grid.xml" file="${build.dir}/nbia-grid.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/macrodefs.xml" file="${build.dir}/macrodefs.xml" overwrite="true"/>
    <copy tofile="${pre-install.dir}/project.properties" file="${build.dir}/project.properties" overwrite="true"/>

    <mkdir dir="${pre-install.dir}/common"/>
    <copydir src="${build.dir}/../common" dest="${pre-install.dir}/common" forceoverwrite="true"/>

    <echo file="${pre-install.dir}/install.properties" message=""/>

    <!-- i dont understand what is going on with globus... this may have something to do
         with tweaking the target dependencies for ahp3.  for now just force  globus into
         the dist jar -->
    <mkdir dir="${pre-install.dir}/tools"/>
    <copy file="${dist.location}/exploded/tools/ws-core-enum-4.0.3.zip"
          todir="${pre-install.dir}/tools"
          overwrite="true"/>

    <copy todir="${pre-install.dir}/bda-utils" overwrite="true">
      <fileset dir="${bda-utils.dir}">
        <include name="**/*" />
      </fileset>
    </copy>
    <jar update="true"
         destfile="${dist.location}/${gui-installer.dist.base.name}-${build.time}.jar"
         basedir="${target.location}/working"
         includes="pre-install/**/*"
      />
    <delete dir="working"/>

  </target>
</project>
